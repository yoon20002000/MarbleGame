# 🎮 MarbleGame - 치지직 연동 2D 구슬 레이싱 게임

Unity로 개발된 2D 구슬 레이싱 게임으로, 치지직(Chzzk) API를 통해 실시간으로 시청자들이 참여할 수 있는 인터랙티브 게임입니다.

## 🎯 게임 개요

- **장르**: 2D 물리 기반 레이싱 게임
- **플랫폼**: Unity (Windows)
- **연동**: 치지직(Chzzk) 실시간 도네이션
- **게임 방식**: 시청자 도네이션 혹은 스트리머가 구슬을 생성하고, 위에서 아래로 떨어지는 구슬들이 목표지점에 마지막에 도착하는 구슬이 승리

## 🚀 주요 기능

### 🎮 게임 시스템

- **승리 조건**: 목표지점(EndPoint)에 마지막에 도착한 구슬이 승리
- **게임 상태 관리**: Idle, Aggregation, RacingStart, Racing, RacingEnd 상태 관리

### 📡 치지직 연동
- **실시간 채팅 연동**: WebSocket을 통한 치지직 채팅 실시간 수신
- **도네이션 연동**: 치지직 도네이션을 통한 구슬 생성
- **자동 재연결**: 연결이 끊어졌을 때 자동으로 재연결 시도

### 🎨 시각적 요소
- **개별 구슬 색상**: 각 구슬마다 랜덤 색상 부여
- **UI 시스템**: 게임 상태 표시, 레이스 시작/중지 버튼
- **실시간 피드백**: 구슬 생성, 레이스 진행 상황 실시간 표시

## 🏗️ 프로젝트 구조

```
Assets/
├── Scripts/
│   ├── MarbleGameManager.cs          # 게임 전체 관리
│   ├── MarbleGame/
│   │   ├── Marble/                   # 구슬 관련 스크립트
│   │   │   ├── Marble.cs            # 구슬 컴포넌트
│   │   │   └── MarbleData.cs        # 구슬 데이터
│   │   └── EndPoint.cs              # 목표지점
│   ├── ChzzAPI/                     # 치지직 API 연동
│   │   └── ChzzkUnity.cs            # 치지직 WebSocket 클라이언트
│   ├── Donation/                    # 도네이션 관리
│   │   ├── DonationManager.cs       # 도네이션 관리자
│   │   └── DonationData.cs          # 도네이션 데이터
│   └── UI/                         # UI 시스템
│       ├── UI_MainLayout.cs         # 메인 레이아웃
│       └── UI_ChzzSetting.cs        # 치지직 설정
├── Prefab/                         # 프리팹
│   ├── Marble.prefab               # 구슬 프리팹
│   ├── EndPoint.prefab             # 목표지점 프리팹
│   └── UI/                         # UI 프리팹들
└── Material/                       # 물리 재질
    └── PhysicsMaterial/            # 구슬 물리 재질
```

## 🎮 게임 플레이 방법

### 1. 치지직 연동 설정
1. 게임 실행 후 치지직 설정 UI에서 채널 ID 입력
2. "집계 시작" 버튼을 눌러 실시간 채팅 연동 시작
3. 연결 상태 확인

### 2. 구슬 생성
- **도네이션으로 생성**: 도네이션 메시지에 `[구슬]"구슬이름"` 포함
- **수동 생성**: UI를 통한 구슬 수동동 추가

### 3. 레이스 시작
1. 최소 2개 이상의 구슬이 생성되고 집계 종료 시시 "레이스 시작!" 버튼 활성화
2. 버튼을 눌러 레이스 시작
3. 구슬들이 물리 법칙에 따라 아래로 떨어지며 경쟁

### 4. 승리 조건
- 목표지점(EndPoint)에 마지막에 도착한 구슬이 승리

## 🔧 기술 스택

- **게임 엔진**: Unity 6 LTS
- **언어**: C#
- **네트워킹**: WebSocketSharp (치지직 연동)
- **비동기 처리**: UniTask
- **UI**: Unity UI + TextMeshPro


## 📦 주요 패키지

- **WebSocketSharp.Standard2**: WebSocket 통신
- **UniTask**: 비동기 작업 처리
- **NuGet for Unity**: 패키지 관리

## 🎯 게임 상태

| 상태 | 설명 |
|------|------|
| **Idle** | 대기 상태, 연결되지 않음 |
| **Aggregation** | 구슬 수집 중, 채팅/도네이션 수신 |
| **RacingStart** | 레이스 시작 준비 |
| **Racing** | 레이스 진행 중 |
| **RacingEnd** | 레이스 종료 |

## 🔌 치지직 API 연동

### 연결 과정
1. 채널 ID를 통한 채널 정보 조회
2. 액세스 토큰 발급
3. WebSocket 연결 및 실시간 채팅 수신
4. 하트비트를 통한 연결 유지

### 메시지 처리
- **도네이션**: 도네이션 정보와 함께 구슬 생성
- **에러 처리**: 잘못된 형식의 메시지 별도 관리

## 🎨 커스터마이징

### 구슬 색상
- 각 구슬마다 자동으로 랜덤덤 색상 부여
- `ColorUtil.cs`를 통한 색상 관리

### 물리 재질
- `Material/PhysicsMaterial/` 폴더에서 구슬 물리 재질 조정
- 탄성, 마찰력 등 물리 속성 커스터마이징 가능

### UI 테마
- TextMeshPro를 활용한 UI 시스템
- 폰트, 색상, 레이아웃 자유롭게 수정 가능

## 🚀 빌드 및 실행

1. Unity6 LTS 설치
2. 프로젝트 클론 또는 다운로드
3. Unity Hub에서 프로젝트 열기
4. 필요한 패키지 자동 설치 대기
5. `Assets/Scenes/SampleScene.unity` 열기
6. Play 버튼으로 게임 실행

## 📝 라이선스

이 프로젝트는 개인 및 교육 목적으로 사용 가능합니다.

## 🤝 기여

버그 리포트, 기능 제안, 코드 기여를 환영합니다!

---

**개발자**: Unity 치지직 API 연동 구슬 레이싱 게임
**버전**: 1.0.0